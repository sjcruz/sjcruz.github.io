{{/* Usage:
   {{< publist section="working" >}}
   {{< publist section="published" >}}
   Rule: "working" = has publication_types: ["working-paper"]; "published" = everything else.
*/}}

{{- $section := .Get "section" | default "published" -}}
{{- $research := site.GetPage "section" "research" -}}
{{- $all := cond $research $research.RegularPages site.RegularPages -}}

{{- /* Partition once */ -}}
{{- $wp := where $all "Params.publication_types" "intersect" (slice "working-paper") -}}
{{- $pubs := complement $all $wp -}}   {{/* complement(ALL, working) = non-working */}}

{{- $list := cond (eq $section "working") $wp $pubs -}}

{{- if gt (len $list) 0 -}}
<ul>
  {{- range $list.ByDate.Reverse -}}
    {{/* Try theme citation partials first */}}
    {{- if templates.Exists "partials/page_metadata/publication_citation" -}}
      <li>{{ partial "page_metadata/publication_citation" . }}</li>
    {{- else if templates.Exists "partials/li_publication" -}}
      <li>{{ partial "li_publication" . }}</li>
    {{- else -}}
      <li>
        <a href="{{ .RelPermalink }}">{{ .Title }}</a>
        {{- with .Params.publication }} â€” <em>{{ . }}</em>{{ end -}}
        {{- if .Date }} ({{ .Date.Format "2006" }}){{ end -}}
      </li>
    {{- end -}}
  {{- end -}}
</ul>
{{- else -}}
<p><em>No entries yet.</em></p>
{{- end -}}
